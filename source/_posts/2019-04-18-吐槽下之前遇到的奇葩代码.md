---
title: 吐槽下之前遇到的奇葩代码
date: 2019-04-18 20:26:02
tags:
    - tucao
thumbnail: /blog/img/random/814268e3gy1fqxxeqbfjgj20b40b4dh7.jpg  

---



> 掐指一算，码龄也三年了，也接手了不少项目，其中有些代码质量不忍直视，从一开始的抗拒也慢慢接受了怎么处理这些难搞的代码。在这里对之前遇到过的让人哭笑不得的写法做些总结，一方面不吐不快，另一方面也提醒自己不要犯同样的错误。


### 滥用if,不用设计模式

 记得刚参加工作的时候，有幸见到了前同事留下的`python web`项目，从`svn`下载下来，刚用`vscode`打开就感觉一股王霸之气铺面而来，`.py`文件一行行`if`,`elif`构成了一条条精美的贝瑟尔曲线，`if`里面是`if`，再往里面还是`if`，一眼看不到尽头，当我要加个新的配置变量，这个请求都要翻过层层的`if`高山，跨过条条`elif`大海，最终才到达它应有的处理函数。更不要说在`python`里面直接拼接`html`代码了。说好的面向对象呢？说好的`mvc`呢？

终于，在排除这些判断条件不会造成影响后，我激动的提交请求，刷新页面，纳尼？怎么没效果呢？於是我打开chrome控制台，发现在某个引入的`js`文件里的不起眼的小角落，又是一层层的`if` `else`。。。

<img src="https://wxt.sinaimg.cn/mw1024/bca3c023gy1g2728tm7b2j20k00jyglx.jpg?tags=%5B%5D" width="20%" height="10%">

孤军奋战了一个月，逐步理清了大部分逻辑后，才慢慢消灭了一部分面条代码，后来呢，估计老板也受不了了，直接让重构了。

到处都是`if else`的代码就像一盘意大利面条，绕来绕去，理不清头绪，那么怎么合理利用`if`呢？好的`if`看起来是树状结构的，而不是n个不相干的`if`穿插另外一些`else`,好的结构就像下面,它们有可能嵌套，有多层的缩进,但是把逻辑却整理的清清楚楚。

```java
if (...) {
  if (...) {
    ...
  } else {
    ...
  }
} else if (...) {
  ...
} else {
  ...
}
```





那么，从这里可以得到什么结论呢？

1. 写合理的`if`结构代码，分支太多[可以用表驱动法消灭](https://baike.baidu.com/item/%E8%A1%A8%E9%A9%B1%E5%8A%A8%E6%B3%95/15768054?fr=aladdin)，比如用`map`储存对应的`condition`和`process`。然后就可以用这个map的key直接拿到要进行的操作了。
2. 大段复用代码抽象为函数。
3. `oo`语言要学会运用面向对象，对象的组合，继承来实现多态，这里需要有一定的抽象能力。

### 不懂语言内置函数

这个就纯粹是经验问题了，不会用语言已经给的标准函数，偏偏自己写逻辑。但是，为啥我遇到那么多这样的代码，难道我接手的项目的都是编程小白写的？

举几个例子：

实现英文转换大小写，我看到是这样写的，定义了一个函数，接受一个字符串作为参数，遍历这个字符串，判断每个字符，如果是小写的`a`就转换为大写的`A`,依次类推，我无F可说了。

从数据库拿到数据后，自己有用冒泡排了顺序。是有多心疼数据库，舍不得让它多干一点事。

用`freemarker`做模板，输出`json`里面有特殊字符，遇到一个就`replace`一个，提交一次代码，就不能看下文档用`${string?JSON}`吗?

and so on...

![](https://wx1.sinaimg.cn/mw1024/bca3c023gy1g272av1q13j207905d749.jpg)



所以。平时没事可以多看看`api`，遇到问题先找找有木有内置的标准库或者函数。免得自己写，效率低还可能有bug。

### 计算机和网络基础薄弱

有个需求是判断`api`请求来源是自己的web产品端还是通过其他微服务接口,有个同事是这样写的，在自己的web端调用每个接口的时候都加了个`FLAG`参数，然后在服务端每个接口都判断下`FLAG`,emmmmm~不说啥了。

判断云服务接口端（http和mqtt协议）是否正常，不实现心跳接口，反而在自己的代码里去`ping`服务端，这里就是不懂网络架构，如果懂网络七层协议，就不会想当然的把能`ping`通当做服务正常了。

还有一些读完文件不释放资源的，不明白异步和同步，在同步的代码里各种`sleep`的。



关于这部分，如果是科班出身的，基础不牢固真的对不起自己在学校花费的时间和经历。

#### 先写到这儿吧。

*题外话*

其实我也很奇怪的，平时自己也会看其他人写的代码，看了很多，总体上发现：

技术上，代码质量上最好的往往是python工程师，写出的代码可读性高，抽象合理。

其次是前端，毕竟现在都在前端框架里面写，也不会差到哪去。

然后是`java`，倒不是难懂，就是不够`oop`，也不够`fp`，感觉像是八股文一样，一层套一层，有些层还啥事都不干.

这里不是地域黑啊，我认为`java`是很优秀的语言，第三方库也诞生了许多优秀的框架。一定也有很多优秀的`java`工程师，可能是我技术不够，还不能与他们同事吧。

------

说了这么多其实自己作为:chicken:时期也写了不少坑爹代码 :wink:，但是现在一点一点积累，不能再犯重复的错误了。    

keep learning,keep coding!共勉！



------















 